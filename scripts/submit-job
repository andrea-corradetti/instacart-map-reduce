#!/usr/bin/env bash

set -euo pipefail

source "$(dirname "$0")/../.env"

echo "ðŸš€ Submitting Spark job to Dataproc..."

JAR_NAME="${JAR_NAME:-imr.jar}"
JAR_PATH="${JAR_PATH:-"$BUCKET"/jars/"$JAR_NAME"}"
INPUT_URI="${INPUT_URI:-"$BUCKET"/order_products.csv}"
OUTPUT_URI="${OUTPUT_URI:-"$BUCKET"/out2}"

gcloud dataproc jobs submit spark \
  --cluster "$CLUSTER" \
  --region "$REGION" \
  --jar "$JAR_PATH" \
  -- \
  --input "$INPUT_URI" \
  --output "$OUTPUT_URI" \
  --force-write

echo "âœ… Job submitted."